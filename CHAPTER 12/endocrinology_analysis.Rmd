---
title: "Endocrinology Data Analysis"
author: "Your Name"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Overview

This analysis examines the ENDOCRIN.DAT dataset, which consists of split-sample plasma determinations of four hormones for each of 5 subjects from one laboratory.

## Load Required Libraries

```{r load-libraries}
library(tidyverse)
library(knitr)
library(ggplot2)
library(irr)  # For intraclass correlation coefficient
```

## Load Data

```{r load-data}
# Read the ENDOCRIN.DAT file from the data sets folder
endocrin_data <- read.table("Rosner_FundamentalsBiostatistics_8e_Data_Sets/ASCII-tab/ENDOCRIN.DAT.txt",
                            header = TRUE,
                            sep = "\t")

# Display structure of the data
str(endocrin_data)

# Display first few rows
head(endocrin_data)

# The dataset contains:
# - Subject: Subject ID (5 subjects total)
# - Replicat: Replicate number (1 or 2 for split-sample)
# - Estrone: Estrone hormone levels
# - Estradol: Estradiol hormone levels
# - Androste: Androstenedione hormone levels
# - Testost: Testosterone hormone levels
```

## Data Summary

```{r data-summary}
# Summary statistics
summary(endocrin_data)

# Display the data in a nice table
kable(endocrin_data, caption = "Endocrinology Dataset - Split-Sample Plasma Determinations")
```

## Data Exploration

```{r data-exploration}
# Number of subjects
n_subjects <- length(unique(endocrin_data$Subject))
cat("Number of subjects:", n_subjects, "\n")

# Check for missing values
cat("\nMissing values:\n")
colSums(is.na(endocrin_data))
```

## Visualizations

```{r visualizations, fig.width=10, fig.height=8}
# Reshape data to long format for visualization
endocrin_long <- endocrin_data %>%
  pivot_longer(cols = c(Estrone, Estradol, Androste, Testost),
               names_to = "Hormone",
               values_to = "Concentration")

# Boxplot of hormone concentrations
ggplot(endocrin_long, aes(x = Hormone, y = Concentration, fill = Hormone)) +
  geom_boxplot() +
  labs(title = "Distribution of Hormone Concentrations",
       x = "Hormone Type",
       y = "Concentration (ng/mL)") +
  theme_minimal() +
  theme(legend.position = "none")

# Split-sample comparison by subject
ggplot(endocrin_data, aes(x = factor(Subject))) +
  geom_point(aes(y = Estrone, color = "Estrone"), size = 3) +
  geom_line(aes(y = Estrone, group = Subject, color = "Estrone")) +
  facet_wrap(~ Replicat, labeller = label_both) +
  labs(title = "Split-Sample Comparison: Estrone Levels by Subject",
       x = "Subject",
       y = "Estrone Concentration",
       color = "Hormone") +
  theme_minimal()

# Comparison of replicates for all hormones
endocrin_wide <- endocrin_data %>%
  pivot_wider(names_from = Replicat,
              values_from = c(Estrone, Estradol, Androste, Testost),
              names_sep = "_Rep")

# Scatter plot comparing replicates for each hormone
par(mfrow = c(2, 2))
with(endocrin_wide, {
  plot(Estrone_Rep1, Estrone_Rep2, main = "Estrone: Replicate 1 vs 2",
       xlab = "Replicate 1", ylab = "Replicate 2", pch = 19, col = "blue")
  abline(0, 1, col = "red", lty = 2)

  plot(Estradol_Rep1, Estradol_Rep2, main = "Estradiol: Replicate 1 vs 2",
       xlab = "Replicate 1", ylab = "Replicate 2", pch = 19, col = "green")
  abline(0, 1, col = "red", lty = 2)

  plot(Androste_Rep1, Androste_Rep2, main = "Androstenedione: Replicate 1 vs 2",
       xlab = "Replicate 1", ylab = "Replicate 2", pch = 19, col = "orange")
  abline(0, 1, col = "red", lty = 2)

  plot(Testost_Rep1, Testost_Rep2, main = "Testosterone: Replicate 1 vs 2",
       xlab = "Replicate 1", ylab = "Replicate 2", pch = 19, col = "purple")
  abline(0, 1, col = "red", lty = 2)
})
```

## Statistical Analysis

```{r statistical-analysis}
# Reliability analysis: Compare split-sample measurements
# Calculate differences between replicates for each hormone

cat("=== Split-Sample Reliability Analysis ===\n\n")

# Reshape to wide format for comparison
endocrin_wide <- endocrin_data %>%
  pivot_wider(names_from = Replicat,
              values_from = c(Estrone, Estradol, Androste, Testost),
              names_sep = "_Rep")

# Calculate differences and correlation for each hormone
hormones <- c("Estrone", "Estradol", "Androste", "Testost")

for (hormone in hormones) {
  rep1 <- endocrin_wide[[paste0(hormone, "_Rep1")]]
  rep2 <- endocrin_wide[[paste0(hormone, "_Rep2")]]

  cat("\n", hormone, ":\n", sep = "")
  cat("  Mean difference (Rep1 - Rep2):", mean(rep1 - rep2), "\n")
  cat("  SD of differences:", sd(rep1 - rep2), "\n")
  cat("  Correlation:", cor(rep1, rep2), "\n")

  # Paired t-test
  t_test <- t.test(rep1, rep2, paired = TRUE)
  cat("  Paired t-test p-value:", t_test$p.value, "\n")
}

# Correlation matrix among hormones (averaging replicates)
cat("\n\n=== Correlation Matrix Among Hormones ===\n\n")
endocrin_avg <- endocrin_data %>%
  group_by(Subject) %>%
  summarise(
    Estrone = mean(Estrone),
    Estradol = mean(Estradol),
    Androste = mean(Androste),
    Testost = mean(Testost)
  )

cor_matrix <- cor(endocrin_avg[, -1])
print(round(cor_matrix, 3))

# Intraclass Correlation Coefficient (ICC) for reliability
cat("\n\n=== Intraclass Correlation Coefficient (ICC) ===\n")
cat("(Measure of reliability between split samples)\n\n")

library(irr)
for (hormone in hormones) {
  rep1 <- endocrin_wide[[paste0(hormone, "_Rep1")]]
  rep2 <- endocrin_wide[[paste0(hormone, "_Rep2")]]

  icc_data <- data.frame(Rep1 = rep1, Rep2 = rep2)
  icc_result <- icc(icc_data, model = "twoway", type = "agreement")

  cat(hormone, "ICC:", round(icc_result$value, 3), "\n")
}
```

## Conclusions

Summary of findings will be added here after analyzing the data.

## Session Information

```{r session-info}
sessionInfo()
```
